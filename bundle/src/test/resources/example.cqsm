DEFINE 'cp.path' '/home/groups/colpal'
DEFINE group.path /home/groups/projects

# Global groups names
DEFINE group.dragonflyBase dragonfly-base
DEFINE group.dragonflyAuthors dragonfly-authors
DEFINE group.dragonflySuperAuthors dragonfly-super-authors
DEFINE group.dragonflyAdministrators dragonfly-administrators
DEFINE group.dragonflyPublishers dragonfly-publishers
DEFINE group.contentReviewers content-reviewers


# Global author group for all colgate sites
CREATE GROUP ${group.dragonflyAuthors} ${cp.path} IF NOT EXISTS
FOR GROUP ${group.dragonflyAuthors}
    SET PROPERTY  profile/givenName 'Dragonfly Authors'

# Global super author group for all colgate sites
CREATE GROUP ${group.dragonflySuperAuthors} ${cp.path} IF NOT EXISTS
FOR GROUP ${group.dragonflySuperAuthors}
    SET PROPERTY  profile/givenName 'Dragonfly Super Authors'

# Global administrators group for all colgate sites
CREATE GROUP ${group.dragonflyAdministrators} ${cp.path} IF NOT EXISTS
FOR GROUP ${group.dragonflyAdministrators}
    SET PROPERTY  profile/givenName 'Dragonfly Administrators'

# Global administrators group for all colgate sites
CREATE GROUP ${group.dragonflyPublishers} ${cp.path} IF NOT EXISTS
FOR GROUP ${group.dragonflyPublishers}
    SET PROPERTY  profile/givenName 'Dragonfly Publishers'
    
# Global content reviewers group for all colgate sites
CREATE GROUP ${group.contentReviewers} ${cp.path} IF NOT EXISTS
FOR GROUP ${group.contentReviewers}
    SET PROPERTY  profile/givenName 'Content Reviewers'
    
# Global base group for all colgate sites
CREATE GROUP ${group.dragonflyBase} ${cp.path} IF NOT EXISTS
FOR GROUP ${group.dragonflyBase}
    SET PROPERTY  profile/givenName 'Dragonfly Base'
    ADD TO GROUP workflow-users
    INCLUDE [${group.dragonflyAuthors}, ${group.dragonflySuperAuthors}, ${group.dragonflyAdministrators}, ${group.dragonflyPublishers}, ${group.contentReviewers}]

# Dragonfly Base Permissions
FOR GROUP ${group.dragonflyBase}
    PURGE    /

    ALLOW     /apps                                                                                                            [READ]
    ALLOW     /libs                                                                                                            [READ]
    ALLOW     /tmp                                                                                                             [READ]

    # Allow to read basic content nodes
    DENY     /content                                                                                                          [READ] IF EXISTS
    ALLOW    /content         STRICT                                                                                           [READ]
    ALLOW    /content         /jcr:primaryType                                                                                 [READ]

    # Allow to read basic dam nodes
    ALLOW    /content/dam     STRICT                                                                                           [READ]
    ALLOW    /content/dam     /jcr:primaryType                                                                                 [READ]
    
    ALLOW    /content/cp-sites                                                                                                 [READ] IF EXISTS
    ALLOW    /content/cp-sites-demo                                                                                            [READ] IF EXISTS
    ALLOW    /content/dam/cp-sites                                                                                             [READ] IF EXISTS
    ALLOW    /content/dam/cp-sites-demo                                                                                        [READ] IF EXISTS

    # Allow pim
    ALLOW    /conf/flexidocs                                                                                                   [READ] IF EXISTS
    ALLOW    /content/pim                                                                                                      [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/dam/pim                                                                                                  [READ,MODIFY,CREATE,DELETE] IF EXISTS
    
    # Allow to read etc files
    ALLOW    /etc/designs                                                                                                      [READ]
    ALLOW    /etc/variants/cp-sites                                                                                            [READ] IF EXISTS
    ALLOW    /etc/tags                                                                                                         [READ] IF EXISTS

    DENY     /content/cp-api                                                                                                   [ALL] IF EXISTS
    ALLOW    /content/cp-api/common/user/loginStatus.flag                                                                      [ALL] IF EXISTS
    ALLOW    /content/cp-api/hills/dealers    /*                                                                               [READ] IF EXISTS
    ALLOW    /content/cp-api/hills/shelters    /*                                                                              [READ] IF EXISTS
    ALLOW    /content/cp-api/hills/user/createUser                                                                             [READ] IF EXISTS
    ALLOW    /content/cp-api/hills/user/resetPassword                                                                          [READ] IF EXISTS
    ALLOW    /content/cp-api/colgate/findADentist                                                                              [READ] IF EXISTS
    ALLOW    /content/cp-api/professional/generatePdf                                                                          [READ] IF EXISTS
    ALLOW    /content/cp-api/professional/sample    /*                                                                         [READ] IF EXISTS
    ALLOW    /content/cp-api/professional/user/createUser                                                                      [READ] IF EXISTS
    ALLOW    /content/cp-api/professional/user/resetPassword                                                                   [READ] IF EXISTS

    # Carty usage
    DENY     /etc/carty                                                                                                        [READ] IF EXISTS

    #Unwanted references report usage
    DENY     /apps/cq/core/content/nav/tools/reportGenerator                                                                   [READ] IF EXISTS
    DENY     /etc/cp-zg-extension/core/unwantedReferenceReportGenerator                                                        [ALL] IF EXISTS

# Dragonfly Authors Permissions 
FOR GROUP ${group.dragonflyAuthors}
    PURGE    /

    # Allow cp-sites and cp-sites-demo
    ALLOW    /content/cp-sites    /*/home                                                                                      [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/cp-sites    /*/home/*                                                                                    [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/cp-sites    /*/templates                                                                                 [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/cp-sites    /*/templates/*                                                                               [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/cp-sites    /*/content                                                                                   [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/cp-sites    /*/content/*                                                                                 [READ,MODIFY,CREATE,DELETE] IF EXISTS
    # note - delete is required to upload asset with the same name
    ALLOW    /content/dam/cp-sites                                                                                             [READ,MODIFY,CREATE,DELETE] IF EXISTS

    ALLOW    /content/cp-sites-demo    /*/home                                                                                 [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/cp-sites-demo    /*/home/*                                                                               [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/cp-sites-demo    /*/templates                                                                            [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/cp-sites-demo    /*/templates/*                                                                          [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/cp-sites-demo    /*/content                                                                              [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/cp-sites-demo    /*/content/*                                                                            [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/dam/cp-sites-demo                                                                                        [READ,MODIFY,CREATE,DELETE] IF EXISTS

    # Allow to edit country selector configuration
    ALLOW    /content/cp-sites/global-country-selector-configuration                                                           [READ,MODIFY]  IF EXISTS
    ALLOW    /content/cp-sites-demo/global-country-selector-configuration                                                      [READ,MODIFY]  IF EXISTS
    ALLOW    /content/cp-sites /*/configuration/country-selector-configuration                                                 [READ,MODIFY]  IF EXISTS
    ALLOW    /content/cp-sites-demo /*/configuration/country-selector-configuration                                            [READ,MODIFY]  IF EXISTS
    
    # Deny Zen Garden tools
    DENY     /apps/cq/core/content/nav/tools/zg                                                                                [READ]
    
    # Disallow to see advanced tabs (Classic UI)

    DENY     /apps/zg/zenGarden/renderers/zenPageRenderer/dialog/items/tabPanel/items/advanced                                 [READ]
    DENY     /apps/zg/zenGarden/renderers/zenPageRenderer/dialog/items/tabPanel/items/cssJsHtml                                [READ]
    DENY     /apps/zg/zenGarden/renderers/zenPageRenderer/dialog/items/tabPanel/items/cloudservices                            [READ]
    DENY     /apps/zg/zenGarden/renderers/zenPageRenderer/dialog/items/tabPanel/items/blueprint                                [READ]
    DENY     /apps/zg/zenGarden/renderers/zenPageRenderer/dialog/items/tabPanel/items/livecopy                                 [READ]

    # Disallow to see advanced tabs (Touch UI)

    DENY     /apps/zg/zenGarden/renderers/zenPageRenderer/cq:dialog/content/items/tabs/items/advanced                          [READ]
    DENY     /apps/zg/zenGarden/renderers/abstractZenRenderer/cq:dialog/content/items/tabs/items/advanced                      [READ]
    DENY     /libs/foundation/components/page/cq:dialog/content/items/tabs/items/advanced                                      [READ]
    DENY     /libs/foundation/components/page/cq:dialog/content/items/tabs/items/cloudservices                                 [READ]
    DENY     /libs/foundation/components/page/cq:dialog/content/items/tabs/items/blueprint                                     [READ]
    DENY     /libs/foundation/components/page/cq:dialog/content/items/tabs/items/permissions                                   [READ]
    DENY     /libs/foundation/components/page/cq:dialog/content/items/tabs/items/livecopy                                      [READ]
    DENY     /libs/foundation/components/page/cq:dialog/content/items/tabs/items/personalization                               [READ]

    # Disallow form handler dialogs
    DENY     /apps/cp-zg-extension/core/handlers/custom-url-handler                                                            [READ]
    DENY     /apps/cp-zg-extension/core/handlers/hills-pet-registration-handler                                                [READ]
    DENY     /apps/cp-zg-extension/core/handlers/login-form-handler                                                            [READ]
    DENY     /apps/cp-zg-extension/core/handlers/reset-password-handler                                                        [READ]
    DENY     /apps/cp-zg-extension/core/handlers/vip_market_check_acc_handler                                                  [READ]

FOR GROUP ${group.dragonflySuperAuthors}
    PURGE    /
    
    ALLOW    /content/pim                                                                                                      [ALL] IF EXISTS
    ALLOW    /content/dam/pim                                                                                                  [ALL] IF EXISTS

    # Allow cp-sites and cp-sites-demo
    ALLOW    /content/cp-sites    /*                                                                                           [ALL] IF EXISTS
    ALLOW    /content/cp-sites-demo    /*                                                                                      [ALL] IF EXISTS
    ALLOW    /content/dam/cp-sites                                                                                             [ALL,READ_ACL,MODIFY_ACL] IF EXISTS
    ALLOW    /content/dam/cp-sites-demo                                                                                        [ALL] IF EXISTS
    ALLOW    /content/dam/crawlers                                                                                             [ALL] IF EXISTS

    ALLOW    /home/groups                                                                                                      [READ]

    # Deny site level configuration except country selector
    DENY     /content/cp-sites    /configuration                                                                               [MODIFY,CREATE,DELETE,REPLICATE] IF EXISTS
    DENY     /content/cp-sites    /layouts                                                                                     [MODIFY,CREATE,DELETE,REPLICATE] IF EXISTS
    ALLOW    /content/cp-sites/global-country-selector-configuration                                                           [READ,MODIFY,REPLICATE]  IF EXISTS
    ALLOW    /content/cp-sites-demo/global-country-selector-configuration                                                      [READ,MODIFY,REPLICATE]  IF EXISTS
   
    # Allow to read and edit etc files
    ALLOW    /etc/designs                                                                                                      [ALL] IF EXISTS
    ALLOW    /etc/variants/cp-sites                                                                                            [ALL] IF EXISTS
    ALLOW    /etc/tags                                                                                                         [ALL] IF EXISTS

    # Enable statistic
    ALLOW    /etc/accelerator/statistics                                                                                       [READ,CREATE,MODIFY,DELETE] IF EXISTS
    ALLOW    /etc/accelerator/statistics    STRICT                                                                             [READ] IF EXISTS
    ALLOW    /apps/cq/core/content/nav/tools/accelerator/statistics                                                            [READ,CREATE,MODIFY,DELETE] IF EXISTS
    
    # Nomad-specific permissions
    ALLOW    /content/projects                                                                                                 [ALL] IF EXISTS
    ALLOW    /content/accelerated-migration                                                                                    [ALL] IF EXISTS
    ALLOW    /content/dam/accelerated-migration                                                                                [ALL] IF EXISTS

FOR GROUP ${group.dragonflyAdministrators}
    PURGE    /

    # Allow pim
    ALLOW    /content/pim                                                                                                      [ALL] IF EXISTS
    ALLOW    /content/dam/pim                                                                                                  [ALL] IF EXISTS

    # Allow cp-sites and cp-sites-demo
    ALLOW    /content/cp-sites                                                                                                 [ALL] IF EXISTS
    ALLOW    /content/cp-sites-demo                                                                                            [ALL] IF EXISTS
    ALLOW    /content/dam/cp-sites                                                                                             [ALL,READ_ACL,MODIFY_ACL] IF EXISTS
    ALLOW    /content/dam/cp-sites-demo                                                                                        [ALL,READ_ACL,MODIFY_ACL] IF EXISTS
    ALLOW    /content/dam/crawlers                                                                                             [ALL] IF EXISTS

    ALLOW    /home/groups                                                                                                      [READ]

    # Allow to read etc files
    ALLOW    /etc/designs                                                                                                      [ALL]
    ALLOW    /etc/variants/cp-sites                                                                                            [ALL] IF EXISTS
    ALLOW    /etc/tags                                                                                                         [ALL] IF EXISTS
    ALLOW    /etc/replication                                                                                                  [ALL] IF EXISTS

    # Nomad-specific permissions
    ALLOW    /content/projects                                                                                                 [ALL] IF EXISTS
    ALLOW    /content/accelerated-migration                                                                                    [ALL] IF EXISTS
    ALLOW    /content/dam/accelerated-migration                                                                                [ALL] IF EXISTS

    #Unwanted references report usage
    ALLOW     /apps/cq/core/content/nav/tools/reportGenerator                                                                  [ALL] IF EXISTS
    ALLOW     /etc/cp-zg-extension/core/unwantedReferenceReportGenerator                                                       [ALL]  IF EXISTS

FOR GROUP ${group.dragonflyPublishers}
    PURGE    /

    ALLOW    /content/pim                                                                                                      [REPLICATE] IF EXISTS
    ALLOW    /content/dam/pim                                                                                                  [REPLICATE] IF EXISTS

    # Allow cp-sites and cp-sites-demo
    ALLOW    /content/cp-sites    /*/home                                                                                      [REPLICATE] IF EXISTS
    ALLOW    /content/cp-sites    /*/home/*                                                                                    [REPLICATE] IF EXISTS
    ALLOW    /content/cp-sites    /*/templates                                                                                 [REPLICATE] IF EXISTS
    ALLOW    /content/cp-sites    /*/templates/*                                                                               [REPLICATE] IF EXISTS
    ALLOW    /content/cp-sites    /*/content                                                                                   [REPLICATE] IF EXISTS
    ALLOW    /content/cp-sites    /*/content/*                                                                                 [REPLICATE] IF EXISTS
    ALLOW    /content/dam/cp-sites                                                                                             [REPLICATE] IF EXISTS

    ALLOW    /content/cp-sites-demo    /*/home                                                                                 [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/cp-sites-demo    /*/home/*                                                                               [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/cp-sites-demo    /*/templates                                                                            [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/cp-sites-demo    /*/templates/*                                                                          [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/cp-sites-demo    /*/content                                                                              [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/cp-sites-demo    /*/content/*                                                                            [READ,MODIFY,CREATE,DELETE] IF EXISTS
    ALLOW    /content/dam/cp-sites-demo                                                                                        [READ,MODIFY,CREATE] IF EXISTS

    # Allow to edit country selector configuration
    ALLOW    /content/cp-sites/global-country-selector-configuration                                                           [REPLICATE]  IF EXISTS
    ALLOW    /content/cp-sites-demo/global-country-selector-configuration                                                      [REPLICATE]  IF EXISTS
    ALLOW    /content/cp-sites /*/configuration/country-selector-configuration                                                 [REPLICATE]  IF EXISTS
    ALLOW    /content/cp-sites-demo /*/configuration/country-selector-configuration                                            [REPLICATE]  IF EXISTS

FOR GROUP ${group.contentReviewers}
    PURGE    /